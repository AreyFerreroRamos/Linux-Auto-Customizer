########################################################################################################################
# - Name: .tmux.conf                                                                                                   #
# - Description: Miscellaneous configuration of tmux using tmux conf syntax.                                           #
# - Creation Date: 11/12/21                                                                                            #
# - Last Modified: 11/12/21                                                                                            #
# - Author & Maintainer: Aleix Mariné-Tena                                                                             #
# - Email: aleix.marine@estudiants.urv.cat                                                                             #
# - Permissions: This script can not be executed directly, only sourced to import its functions and process its own    #
# imports. See the header of each function to see its privilege requirements.                                          #
# - Arguments: No arguments                                                                                            #
# - Usage: Not executed directly, sourced from install.sh                                                              #
# - License: GPL v2.0                                                                                                  #
########################################################################################################################

########################################################################################################################
###################################################### VARIABLES #######################################################
########################################################################################################################


# Dracula Colours
BACKGROUND_COLOR='#282a36'
BACKGROUND_COLOR_SECONDARY='#2c001e'
CURRENT_LINE_COLOR='#44475a'
FOREGROUND_COLOR='#f8f8f2'
FOREGROUND_COLOR_SECONDARY='#ff79c6'
FOREGROUND_COLOR_TERTIARY='#bd93f9'
COMMENT_COLOR='#6272a4'
CYAN='#8be9fd'
GREEN='#50fa7b'
ORANGE='#ffb86c'
PINK='#ff79c6'
PURPLE='#bd93f9'
RED='#ff5555'
YELLOW='#f1fa8c'
GREY="colour233"
BLUE="colour4"
BLACK="#000000"
WHITE="colour252"

########################################################################################################################
###################################################### INTERFACES ######################################################
########################################################################################################################
# This allows the use of the mouse to manipulate the panes and windows of tmux. This is equivalent to:
# set -g mouse-select-window on  # Clickable windows
# set -g mouse-select-pane on  # Clickable panes
# set -g mouse-resize-pane on  # Resizable panes
set -g mouse on
# Ctrl Scroll to Zoom
bind -T root C-WheelUpPane {
       run-shell "xdotool key Ctrl+plus"
}

bind -T root C-WheelDownPane {
       run-shell "xdotool key Ctrl+minus"
}

bind -T root C-MouseDown2Pane {
       run-shell "xdotool key Ctrl+0"
}


# Sets the system variable $TERM
set -g default-terminal "screen-256color"

# Drag to re-order windows
bind -n MouseDrag1Status swap-window -t=

# Double click on the window list to open a new window
bind -n DoubleClick1Status new-window

##### Clipboard integration #####
#{


# Selection with mouse should copy to clipboard right away, in addition to the default action.
unbind -n -Tcopy-mode-vi MouseDragEnd1Pane
bind -Tcopy-mode-vi MouseDragEnd1Pane send -X copy-selection-and-cancel\; run "tmux save-buffer - | xclip -i -sel clipboard > /dev/null"

# Update default binding of Enter to also use copy-pipe
unbind -T copy-mode-vi Enter
bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "xclip -selection c"
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -in -selection clipboard"

unbind MouseDown2Pane
bind -n MouseDown2Pane run "tmux set-buffer -- \"$(xclip -o -sel primary);\"; tmux paste-buffer -p"
#}









########################################################################################################################
###################################################### BEHAVIOUR #######################################################
########################################################################################################################

# https://github.com/neovim/neovim/issues/2035
# Time passed for the keyboard device to recognize an escape sequence. By default is set to 500 ms which makes tmux
# misinterpret an actual press of the ESC key with an escape sequence.
# ESC delay after prefix (ms)
set -sg escape-time 10

# By default tmux will update the window title automatically depending on the last executed command within that window.
# In order to prevent tmux from overriding window names automatic renaming is turned off. You can turn it on by
# commenting the following lines and commenting out the other.
#set -g allow-rename on
#setw -g automatic-rename
#set -g automatic-rename-format '#{b:pane_current_path}'
set -g allow-rename off

# Rather than constraining window size to the maximum size of any client
# connected to the *session*, constrain window size to the maximum size of any
# client connected to *that window*. Much more reasonable.
# Useful when using "grouped sessions" and multi-monitor setup
setw -g aggressive-resize on

# Sane scrolling
set -g terminal-overrides 'xterm*:smcup@:rmcup@'

# Start numbering sessions on 1
set -g base-index 1
setw -g pane-base-index 1

# Be able to receive focus events enabled for terminals that support them. Necessary (?)
set -g focus-events on

# Track if there is new output in windows
setw -g monitor-activity on

# Show message when output is received in a non-active window
set -g visual-activity on



########################################################################################################################
###################################################### BINDINGS ########################################################
########################################################################################################################

# C-b is not acceptable -- Vim uses it
set -g prefix C-a
bind C-a last-window
bind a send-prefix

# # Use vim keybindings in copy mode
setw -g mode-keys vi

# hjkl pane traversal
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# resize pane
bind -r K resize-pane -U
bind -r J resize-pane -D
bind -r L resize-pane -R
bind -r H resize-pane -L
bind    m resize-pane -Z

# split panes using | and -
bind | split-window -h -p 50 -c "#{pane_current_path}"
bind - split-window -v -p 50 -c "#{pane_current_path}"
unbind '"'
unbind %

bind c new-window -c "#{pane_current_path}"
bind i command-prompt -p 'Insert window at:' 'new-window -c "#{pane_current_path}" -a -t %1; swap-window -t -1'
bind I command-prompt -p 'New window at:' 'new-window -c "#{pane_current_path}" -t %1'
bind C command-prompt -p "Name of new window: " "new-window -n '%%'"

# reload config
bind r source-file ~/.tmux.conf \; display-message "Config reloaded..."

# ctrl+c to send to clipboard
bind C-c run "tmux save-buffer - | xclip -i -sel clipboard"

# ctrl+v to paste from clipboard
bind C-v run "tmux set-buffer \"$(xclip -o -sel clipboard)\"; tmux paste-buffer"








########################################################################################################################
############################################################ UI ########################################################
########################################################################################################################

# Windows
#{
WINDOW="[#W]"

setw -g window-status-current-format $WINDOW
setw -g window-status-format $WINDOW

# default window title colors
setw -g window-status-style fg=$FOREGROUND_COLOR_SECONDARY,bg=default

# active window title colors
setw -g window-status-current-style fg=$FOREGROUND_COLOR_TERTIARY,bg=$BACKGROUND_COLOR_SECONDARY

setw -g window-status-activity-style fg=$GREEN,bg=$BLACK,none
# set active/pasive pane background colours
set -g window-style fg=$WHITE

set -g window-active-style bg=$BACKGROUND_COLOR
#}


# Panes
#{
setw -g pane-border-format '#{pane_index}#{pane_current_path}'

# pane border
set -g pane-active-border-style fg=YELLOW,bg=$BACKGROUND_COLOR
set -g pane-border-style fg=$BLUE,bg=default

# Put the status border of the pane at the top
set -g pane-border-status top

# Show the command running on the status border of a pane
set -g pane-border-format "#P: #{pane_current_command}"

# pane number display
set -g display-panes-active-colour $GREEN
set -g display-panes-colour $WHITE
#}



# Status bar
#{
set -g status 'on'

# redraw status line every 1 second
set -g status-interval 1

# Hardcoded length for the status bars
set -g status-left-length 52
set -g status-right-length 100

# Activate it to change the position of the status bar
#set -g status-position top

# Activate it to put the text of the status bar in the center
#set -g status-justify 'centre'


set -g status-left '#[fg=$FOREGROUND_COLOR_SECONDARY,bg=$BACKGROUND_COLOR_SECONDARY]#S#[fg=$WHITE,bg=$BACKGROUND_COLOR_SECONDARY,nobold,nounderscore,noitalics]#[fg=$FOREGROUND_COLOR_SECONDARY,bg=$BACKGROUND_COLOR_SECONDARY]#{s|/home/|~/|$HOME|~|=:pane_current_command}#[fg=$WHITE,bg=$BACKGROUND_COLOR_SECONDARY,nobold,nounderscore,noitalics]'
set -g status-right '#[fg=$FOREGROUND_COLOR,bold]#(bash €{CURRENT_INSTALLATION_FOLDER}/clockmoji.sh)#[default]'
# Current windows tab displays username in red, sorrounded by [] in bold green
set -g window-status-current-format "#[fg=$GREEN, bg=$BACKGROUND_COLOR, bold][#[fg=$RED,bold]#(whoami)#[fg=$GREEN,bold]]"

set -g status-bg $BACKGROUND_COLOR_SECONDARY
set -g status-fg $WHITE
#}

# Other
#{
# colorize messages in the command line

set -g message-command-style fg=$BLACK,bg=$CYAN
set -g message-style fg=$BLACK,bg=$CYAN

# clock
setw -g clock-mode-colour $GREEN

# Set the window title
set -g set-titles on
set -g set-titles-string '#T.tmux.#S.#W.#P'
#}
